<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Library App</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 20px;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        background: white;
        border-radius: 15px;
        padding: 30px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      }

      h1 {
        text-align: center;
        color: #667eea;
        margin-bottom: 30px;
        font-size: 2.5em;
      }

      #stats {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 20px;
        border-radius: 10px;
        margin-bottom: 30px;
        display: flex;
        justify-content: space-around;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
      }

      #stats p {
        font-size: 1.2em;
        font-weight: bold;
      }

      #stats span {
        background: rgba(255, 255, 255, 0.2);
        padding: 5px 15px;
        border-radius: 20px;
        margin-left: 10px;
      }

      .search-section {
        background: #f8f9fa;
        padding: 20px;
        border-radius: 10px;
        margin-bottom: 20px;
        border-left: 4px solid #667eea;
      }

      .search-section h3 {
        color: #667eea;
        margin-bottom: 15px;
      }

      input[type="text"],
      input[type="number"] {
        padding: 10px 15px;
        border: 2px solid #ddd;
        border-radius: 5px;
        font-size: 1em;
        margin-right: 10px;
        transition: border-color 0.3s;
      }

      input[type="text"]:focus,
      input[type="number"]:focus {
        outline: none;
        border-color: #667eea;
      }

      button {
        padding: 10px 20px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 1em;
        font-weight: bold;
        transition: transform 0.2s, box-shadow 0.2s;
      }

      button:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
      }

      button:active {
        transform: translateY(0);
      }

      .result-text {
        margin-top: 10px;
        padding: 10px;
        background: #e8f4f8;
        border-radius: 5px;
        color: #333;
        min-height: 20px;
      }

      #books {
        display: flex;
        flex-wrap: wrap;
        gap: 20px;
        margin-top: 30px;
      }

      .card {
        background: white;
        border: 2px solid #e0e0e0;
        padding: 20px;
        border-radius: 12px;
        width: 250px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        transition: transform 0.3s, box-shadow 0.3s;
      }

      .card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
      }

      .card h3 {
        color: #667eea;
        margin-bottom: 15px;
        font-size: 1.3em;
        border-bottom: 2px solid #667eea;
        padding-bottom: 10px;
      }

      .card p {
        margin: 8px 0;
        color: #555;
        line-height: 1.6;
      }

      .card button {
        width: 100%;
        margin-top: 10px;
      }

      .card button:first-of-type {
        background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
      }

      .card button:last-of-type {
        background: linear-gradient(135deg, #eb3349 0%, #f45c43 100%);
      }

      .add-book-link {
        display: inline-block;
        margin-top: 30px;
        padding: 15px 30px;
        background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        color: white;
        text-decoration: none;
        border-radius: 25px;
        font-weight: bold;
        transition: transform 0.2s;
        box-shadow: 0 5px 15px rgba(245, 87, 108, 0.3);
      }

      .add-book-link:hover {
        transform: scale(1.05);
      }

      @media (max-width: 768px) {
        .card {
          width: 100%;
        }

        #stats {
          flex-direction: column;
          gap: 10px;
        }
      }
    </style>
  </head>
  <body>
    <div id="stats">
      <p>Total livres: <span id="total"></span></p>
      <p>Livres disponibles: <span id="dispo"></span></p>
    </div>

    <div>
      <h3>Afficher un livre par code</h3>
      <input type="number" id="searchCode" placeholder="Entrer code" />
      <button id="btnShowByCode">Afficher</button>
      <p id="resultCode"></p>
    </div>

    <div>
      <h3>Rechercher un livre par titre</h3>
      <input type="text" id="searchTitre" placeholder="Entrer titre" />
      <button id="btnSearchTitre">Rechercher</button>
      <p id="resultTitre"></p>
    </div>

    <div>
      <h3>Supprimer un livre par code</h3>
      <input type="number" id="deleteCode" placeholder="Entrer code" />
      <button id="btnDeleteByCode">Supprimer</button>
    </div>

    <div id="books"></div>
    <a href="ajouter-livre.html">add book</a>

    <script>
      let bibliotheque = JSON.parse(localStorage.getItem("bibliotheque")) || [];
      // IDA TABLO KHAWI KY3ML DEFAULT TABLO
      if (bibliotheque.length === 0) {
        bibliotheque = [
          {
            code: 12,
            titre: "Clean Code",
            auteur: "Robert C. Martin",
            annee: 2008,
            disponible: true,
            prix: 150,
          },
          {
            code: 45,
            titre: "Eloquent JavaScript",
            auteur: "Marijn Haverbeke",
            annee: 2018,
            disponible: true,
            prix: 200,
          },
          {
            code: 67,
            titre: "You Don’t Know JS",
            auteur: "Kyle Simpson",
            annee: 2015,
            disponible: false,
            prix: 180,
          },
        ];
        localStorage.setItem("bibliotheque", JSON.stringify(bibliotheque));
      }

      const booksContainer = document.getElementById("books");
      const totalSpan = document.getElementById("total");
      const dispoSpan = document.getElementById("dispo");
      // UPDATE STATS FUNCTION
      function updateStats() {
        totalSpan.textContent = bibliotheque.length;
        dispoSpan.textContent = bibliotheque.filter((b) => b.disponible).length;
      }

      function createBookCard(book, index) {
        const card = document.createElement("div");
        card.classList.add("card");

        const title = document.createElement("h3");
        title.textContent = book.titre;

        const auteur = document.createElement("p");
        auteur.textContent = "Auteur : " + book.auteur;

        const code = document.createElement("p");
        code.textContent = "Code : " + book.code;

        const annee = document.createElement("p");
        annee.textContent = "Année : " + book.annee;

        const prix = document.createElement("p");
        prix.textContent = "Prix : " + book.prix + " DH";

        const disponible = document.createElement("p");
        disponible.textContent = book.disponible
          ? "Disponible"
          : "Non disponible";

        const reserveBtn = document.createElement("button");
        reserveBtn.innerText = book.disponible ? "Reserver" : "Réservé";

        reserveBtn.addEventListener("click", function () {
          book.disponible = !book.disponible;
          disponible.textContent = book.disponible
            ? "Disponible"
            : "Non disponible";
          reserveBtn.innerText = book.disponible ? "Reserver" : "Réservé";
          // Update localStorage
          localStorage.setItem("bibliotheque", JSON.stringify(bibliotheque));
          // Update stats
          updateStats();
        });

        const deleteBtn = document.createElement("button");
        deleteBtn.innerText = "Supprimer";

        deleteBtn.addEventListener("click", function () {
          // KYS9SIK WAX MT2KED
          if (confirm(`Delete "${book.titre}" ?`)) {
            bibliotheque.splice(index, 1);
            localStorage.setItem("bibliotheque", JSON.stringify(bibliotheque));
            card.remove();
            // IDA MSA7 KY UPDATE STATS
            updateStats();
          }
        });

        card.append(
          title,
          auteur,
          code,
          annee,
          prix,
          disponible,
          reserveBtn,
          deleteBtn
        );
        booksContainer.appendChild(card);
      }

      bibliotheque.forEach((book, index) => createBookCard(book, index));
      updateStats();

      // SEARCHER B CODE
      document.getElementById("btnShowByCode").addEventListener("click", () => {
        const code = parseInt(document.getElementById("searchCode").value);
        const livre = bibliotheque.find((b) => b.code === code);
        document.getElementById("resultCode").textContent = livre
          ? `${livre.titre} - ${livre.auteur} (${livre.annee})`
          : "Aucun livre trouvé";
      });

      // SEARCHER B TITLE
      document
        .getElementById("btnSearchTitre")
        .addEventListener("click", () => {
          const titre = document
            .getElementById("searchTitre")
            .value.toLowerCase();
          const livre = bibliotheque.find((b) =>
            b.titre.toLowerCase().includes(titre)
          );
          document.getElementById("resultTitre").textContent = livre
            ? `Code ${livre.code} - ${livre.titre} (${livre.auteur})`
            : "Aucun livre trouvé";
        });

      // DELETE B CODE
      document
        .getElementById("btnDeleteByCode")
        .addEventListener("click", () => {
          const code = parseInt(document.getElementById("deleteCode").value);
          const index = bibliotheque.findIndex((b) => b.code === code);
          if (index !== -1) {
            if (confirm(`Supprimer "${bibliotheque[index].titre}" ?`)) {
              bibliotheque.splice(index, 1);
              localStorage.setItem(
                "bibliotheque",
                JSON.stringify(bibliotheque)
              );
              alert("Livre supprimé !");
              location.reload();
            }
          } else {
            alert("Aucun livre trouvé avec ce code");
          }
        });
    </script>
  </body>
</html>
